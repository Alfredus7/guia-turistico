@model IEnumerable<guia_turistico.Models.SitioTuristico>

@{
    ViewData["Title"] = "Mapa de Sitios Turísticos";
}

<h2 class="text-center my-4">Mapa de Sitios Turísticos de Trinidad</h2>

<div id="mapa" style="height: 600px; border-radius: 10px;"></div>

@section Scripts {
    <!-- Leaflet CSS y JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Inicializamos el mapa centrado en Trinidad
        var mapa = L.map('mapa').setView([-14.8333, -64.9], 14);

        // Capa base de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
        }).addTo(mapa);

        // Icono por defecto de Leaflet
        var defaultIcon = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Icono distinto para la ciudad principal
        var cityIcon = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Agregar marcadores para cada sitio turístico
        @foreach (var sitio in Model)
        {
                <text>
                    console.log('Agregando marcador: ', '@sitio.Nombre', @sitio.Latitud, @sitio.Longitud);

                    var marker = L.marker([@sitio.Latitud.ToString().Replace(",", "."), @sitio.Longitud.ToString().Replace(",", ".")], {
                        icon: defaultIcon
                    }).addTo(mapa);

                    // Popup con nombre, dirección y botón "Ver detalles"
                    marker.bindPopup(`
                        <div style="min-width: 220px; text-align: center;">
                            <h5 style="margin: 0 0 10px 0; color: #2c3e50; font-weight: bold;">@sitio.Nombre</h5>
                            <p style="margin: 5px 0; font-size: 12px; color: #666;">@(sitio.Direccion ?? "Sin dirección especificada")</p>
                            <a href='@Url.Action("Details", "SitioTuristicoes", new { id = sitio.Id })'
                               class="btn btn-sm btn-primary"
                               style="margin-top: 5px; background-color: #3498db; border: none; color: white; padding: 5px 10px; border-radius: 5px; text-decoration: none;">
                               Ver detalles
                            </a>
                        </div>
                    `);
                </text>
        }

        // Marcador de la ciudad de Trinidad
        var trinidadMarker = L.marker([-14.8333, -64.9], { icon: cityIcon }).addTo(mapa);
        trinidadMarker.bindPopup("<b>🏙️ Ciudad de Trinidad</b><br>Beni, Bolivia");

        // Controles de zoom
        L.control.zoom({ position: 'topright' }).addTo(mapa);

        // Mostrar coordenadas al hacer clic en el mapa (solo para debug)
        mapa.on('click', function(e) {
            console.log('Coordenadas click:', e.latlng.lat, e.latlng.lng);
        });
    </script>
}
