@model IEnumerable<guia_turistico.Models.SitioTuristico>

@{
    ViewData["Title"] = "Mapa de Sitios Turísticos";
}

<h2 class="text-center my-4">Mapa de Sitios Turísticos de Trinidad</h2>

<div id="mapa" style="height: 600px; border-radius: 10px;"></div>

@section Scripts {
    <!-- Leaflet CSS y JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Inicializamos el mapa centrado en Trinidad
        var mapa = L.map('mapa').setView([-14.8333, -64.9], 14);

        // Capa base
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
        }).addTo(mapa);

        // Usar los iconos por defecto de Leaflet (no necesitan archivos locales)
        var defaultIcon = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Icono diferente para la ciudad
        var cityIcon = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Agregar marcadores para cada sitio turístico
        @foreach (var sitio in Model)
        {
                <text>
                console.log('Agregando marcador: ', '@sitio.Nombre', @sitio.Latitud, @sitio.Longitud);

                var marker = L.marker([@sitio.Latitud.ToString().Replace(",", "."), @sitio.Longitud.ToString().Replace(",", ".")], {
                    icon: defaultIcon
                }).addTo(mapa);

                // Hacer clic en el marcador redirige a Details
                marker.on('click', function() {
                    window.location.href = '@Url.Action("Details", "SitiosTuristicos", new { id = sitio.Id })';
                });

                // Popup informativo
                marker.bindPopup(`
                    <div style="min-width: 200px; text-align: center;">
                        <h5 style="margin: 0 0 10px 0; color: #2c3e50; font-weight: bold;">@sitio.Nombre</h5>
                        <p style="margin: 5px 0; font-size: 12px; color: #666;">@(sitio.Direccion ?? "Sin dirección especificada")</p>
                        <p style="margin: 5px 0; font-size: 11px; color: #888;">Haz clic en el marcador para ver detalles</p>
                    </div>
                `);
                </text>
        }

        // Marcador de Trinidad
        var trinidadMarker = L.marker([-14.8333, -64.9], { icon: cityIcon }).addTo(mapa);
        trinidadMarker.bindPopup("<b>🏙️ Ciudad de Trinidad</b><br>Beni, Bolivia");

        // Agregar controles de zoom
        L.control.zoom({ position: 'topright' }).addTo(mapa);

        // Debug: mostrar coordenadas al hacer clic en el mapa
        mapa.on('click', function(e) {
            console.log('Coordenadas click:', e.latlng.lat, e.latlng.lng);
        });
    </script>
}