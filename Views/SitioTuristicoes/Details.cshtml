@model guia_turistico.Models.SitioTuristico

@{
    ViewData["Title"] = "Detalles del Sitio Turístico";
    var selectedLanguage = Context.Request.Cookies["selectedLanguage"] ?? "es";
}

<div class="container my-5">
    <div class="text-center mb-4">
        <h1 class="fw-bold display-5">
            @switch (selectedLanguage)
            {
                case "en":
                    <text>@(string.IsNullOrEmpty(Model.NombreIngles) ? Model.Nombre : Model.NombreIngles)</text>
                    ; break;
                case "pt":

                    <text>@(string.IsNullOrEmpty(Model.NombrePortugues) ? Model.Nombre : Model.NombrePortugues)</text>
                    ; break;
                default:

                    <text>@Model.Nombre</text>
                    ; break;
            }
        </h1>

        <p class="text-muted">
            @switch (selectedLanguage)
            {
                case "en":
                    <text>Learn more about this place</text>
                    ; break;
                case "pt":

                    <text>Saiba mais sobre este lugar</text>
                    ; break;
                default:

                    <text>Descubre más sobre este lugar</text>
                    ; break;
            }
        </p>
    </div>

    <!-- Carousel de Imágenes -->
    @if (Model.Imagenes != null && Model.Imagenes.Any())
    {
        <div class="card shadow-lg border-0 mb-5">
            <div class="card-body p-0">
                <div id="sitioCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        @for (int i = 0; i < Model.Imagenes.Count; i++)
                        {
                            <button type="button" data-bs-target="#sitioCarousel" data-bs-slide-to="@i"
                                    class="@(i == 0 ? "active" : "")" aria-label="Slide @(i + 1)"></button>
                        }
                    </div>

                    <div class="carousel-inner rounded-3">
                        @for (int i = 0; i < Model.Imagenes.Count; i++)
                        {
                            var imagen = Model.Imagenes.ElementAt(i);
                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                <img src="@imagen.Url" class="d-block w-100" style="height: 450px; object-fit: cover;" alt="@Model.Nombre">
                            </div>
                        }
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#sitioCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">
                            @switch (selectedLanguage)
                            {
                                case "en":
                                    <text>Previous</text>
                                    ; break;
                                case "pt":

                                    <text>Anterior</text>
                                    ; break;
                                default:

                                    <text>Anterior</text>
                                    ; break;
                            }
                        </span>
                    </button>

                    <button class="carousel-control-next" type="button" data-bs-target="#sitioCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">
                            @switch (selectedLanguage)
                            {
                                case "en":
                                    <text>Next</text>
                                    ; break;
                                case "pt":

                                    <text>Próximo</text>
                                    ; break;
                                default:

                                    <text>Siguiente</text>
                                    ; break;
                            }
                        </span>
                    </button>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info text-center shadow-sm">
            <i class="fas fa-image"></i>
            @switch (selectedLanguage)
            {
                case "en":
                    <text>No images available for this tourist site.</text>
                    ; break;
                case "pt":

                    <text>Não há imagens disponíveis para este local turístico.</text>
                    ; break;
                default:

                    <text>No hay imágenes disponibles para este sitio turístico.</text>
                    ; break;
            }
        </div>
    }

    <!-- Información -->
    <div class="card shadow-sm border-0 mb-5">
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3 fw-bold">
                    @switch (selectedLanguage)
                    {
                        case "en":
                            <text>Description</text>
                            ; break;
                        case "pt":

                            <text>Descrição</text>
                            ; break;
                        default:

                            <text>Descripción</text>
                            ; break;
                    }
                </dt>
                <dd class="col-sm-9">
                    @switch (selectedLanguage)
                    {
                        case "en":
                            <span>@(string.IsNullOrEmpty(Model.DescripcionIngles) ? Model.Descripcion : Model.DescripcionIngles)</span>
                            break;
                        case "pt":
                            <span>@(string.IsNullOrEmpty(Model.DescripcionPortugues) ? Model.Descripcion : Model.DescripcionPortugues)</span>
                            break;
                        default:
                            <span>@Model.Descripcion</span>
                            break;
                    }
                </dd>

                <dt class="col-sm-3 fw-bold">
                    @switch (selectedLanguage)
                    {
                        case "en":
                            <text>Address</text>
                            ; break;
                        case "pt":

                            <text>Endereço</text>
                            ; break;
                        default:

                            <text>Dirección</text>
                            ; break;
                    }
                </dt>
                <dd class="col-sm-9">@Model.Direccion</dd>
            </dl>
        </div>
    </div>

    <!-- Calificación general -->
    <div class="text-center mb-4">
        <h3 class="mb-2">
            ⭐
            @switch (selectedLanguage)
            {
                case "en":
                    <text>Overall Rating:</text>
                    ; break;
                case "pt":

                    <text>Avaliação Geral:</text>
                    ; break;
                default:

                    <text>Calificación General:</text>
                    ; break;
            }
            <span class="text-primary">@Model.PuntuacionPromedio.ToString("0.0")</span> / 5
        </h3>
        <div>
            @for (int i = 1; i <= 5; i++)
            {
                if (i <= Math.Round(Model.PuntuacionPromedio))
                {
                    <i class="fas fa-star text-warning fs-4"></i>
                }
                else
                {
                    <i class="far fa-star text-muted fs-4"></i>
                }
            }
        </div>
    </div>

    <!-- Comentarios -->
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            @if (User.Identity.IsAuthenticated)
            {
                <form asp-action="AgregarComentario" method="post">
                    <input type="hidden" name="sitioId" value="@Model.Id" />

                    <div class="mb-3">
                        <label class="form-label fw-semibold">
                            @switch (selectedLanguage)
                            {
                                case "en":
                                    <text>Your Rating:</text>
                                    ; break;
                                case "pt":

                                    <text>Sua Avaliação:</text>
                                    ; break;
                                default:

                                    <text>Tu puntuación:</text>
                                    ; break;
                            }
                        </label>
                        <div id="ratingStars">
                            @for (int i = 1; i <= 5; i++)
                            {
                                <i class="far fa-star star-select text-warning fs-4 mx-1" data-value="@i" style="cursor:pointer;"></i>
                            }
                            <input type="hidden" id="puntuacion" name="puntuacion" value="0" />
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="texto" class="form-label fw-semibold">
                            @switch (selectedLanguage)
                            {
                                case "en":
                                    <text>Your opinion:</text>
                                    ; break;
                                case "pt":

                                    <text>Sua opinião:</text>
                                    ; break;
                                default:

                                    <text>Tu opinión:</text>
                                    ; break;
                            }
                        </label>
                        <textarea class="form-control shadow-sm" id="texto" name="texto" rows="3" maxlength="500" required></textarea>
                    </div>

                    <button type="submit" class="btn btn-success px-4">
                        @switch (selectedLanguage)
                        {
                            case "en":
                                <text>Submit Review</text>
                                ; break;
                            case "pt":

                                <text>Enviar Opinião</text>
                                ; break;
                            default:

                                <text>Enviar Opinión</text>
                                ; break;
                        }
                    </button>
                </form>
            }
            else
            {
                <div class="alert alert-warning text-center">
                    <i class="fas fa-lock"></i>
                    @switch (selectedLanguage)
                    {
                        case "en":
                            <text>You must log in to leave a review.</text>
                            ; break;
                        case "pt":

                            <text>Você deve fazer login para deixar uma opinião.</text>
                            ; break;
                        default:

                            <text>Debes iniciar sesión para dejar tu opinión.</text>
                            ; break;
                    }
                </div>
            }
        </div>
    </div>

    <!-- Opiniones -->
    <div class="mt-5">
        <h4 class="mb-4">
            💬
            @switch (selectedLanguage)
            {
                case "en":
                    <text>User Reviews</text>
                    ; break;
                case "pt":

                    <text>Opiniões dos Usuários</text>
                    ; break;
                default:

                    <text>Opiniones de usuarios</text>
                    ; break;
            }
        </h4>
        @if (Model.Comentarios != null && Model.Comentarios.Any())
        {
            foreach (var comentario in Model.Comentarios.OrderByDescending(c => c.Fecha))
            {
                <div class="card mb-3 shadow-sm border-0">
                    <div class="card-body">
                        <h6 class="fw-bold mb-2">
                            <i class="fas fa-user-circle"></i> @comentario.NombreUsuario
                            <small class="text-muted">(@comentario.Fecha.ToShortDateString())</small>
                        </h6>
                        <div class="mb-2">
                            @for (int i = 1; i <= 5; i++)
                            {
                                if (i <= comentario.Puntuacion)
                                {
                                    <i class="fas fa-star text-warning"></i>
                                    ;
                                }
                                else
                                {

                                    <i class="far fa-star text-muted"></i>
                                    ;
                                }
                            }
                        </div>
                        <p>@comentario.Texto</p>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="alert alert-info shadow-sm">
                @switch (selectedLanguage)
                {
                    case "en":
                        <text>No comments yet. Be the first to share your experience.</text>
                        ; break;
                    case "pt":

                        <text>Ainda não há comentários. Seja o primeiro a opinar.</text>
                        ; break;
                    default:

                        <text>Aún no hay comentarios. Sé el primero en opinar.</text>
                        ; break;
                }
            </div>
        }
    </div>

    <div class="mt-4 text-center">
        <a asp-controller="Home" asp-action="Index" class="btn btn-secondary">
            @switch (selectedLanguage)
            {
                case "en":
                    <text>Back</text>
                    ; break;
                case "pt":

                    <text>Voltar</text>
                    ; break;
                default:

                    <text>Volver hacia atrás</text>
                    ; break;
            }
        </a>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const stars = document.querySelectorAll(".star-select");
            const input = document.getElementById("puntuacion");
            stars.forEach(star => {
                star.addEventListener("click", () => {
                    const val = star.getAttribute("data-value");
                    input.value = val;
                    stars.forEach(s => s.classList.replace("fas", "far"));
                    for (let i = 0; i < val; i++) stars[i].classList.replace("far", "fas");
                });
            });
            const currentLang = localStorage.getItem('selectedLanguage') || 'es';
            document.cookie = `selectedLanguage=${currentLang}; path=/; max-age=31536000`;
        });
    </script>
}
